# PR #2: 보안 아키텍처 상세화

**작성일**: 2026-02-04
**상태**: Draft
**다음 PR**: PR #8 (인포그래픽)

---

## Executive Summary

OpenClaw + VDI + 내부망 LLM 환경의 **5계층 보안 아키텍처**를 정의합니다.
망분리 정책을 유지하면서 AI 비서 서비스를 안전하게 제공하는 것이 목표입니다.

---

## 1. 5계층 보안 프레임워크

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        5계층 보안 아키텍처                               │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ╔═══════════════════════════════════════════════════════════════════╗  │
│  ║  Layer 5: 접근 제어 (Access Control)                               ║  │
│  ║  ┌──────────────┬──────────────┬──────────────┬──────────────┐   ║  │
│  ║  │ DID 인증     │ 2FA (OTP)    │ RBAC/ABAC   │ 세션 관리    │   ║  │
│  ║  │ (모바일신분증)│ (시간기반)   │ (역할권한)   │ (타임아웃)   │   ║  │
│  ║  └──────────────┴──────────────┴──────────────┴──────────────┘   ║  │
│  ╚═══════════════════════════════════════════════════════════════════╝  │
│                                    │                                    │
│  ╔═══════════════════════════════════════════════════════════════════╗  │
│  ║  Layer 4: 네트워크 분리 (Network Isolation)                        ║  │
│  ║  ┌──────────────┬──────────────┬──────────────┬──────────────┐   ║  │
│  ║  │ 물리적 망분리 │ VDI 프로토콜 │ 방화벽      │ VPN 터널    │   ║  │
│  ║  │ (인터넷/내부) │ (화면전송)   │ (화이트리스트)│ (암호화)    │   ║  │
│  ║  └──────────────┴──────────────┴──────────────┴──────────────┘   ║  │
│  ╚═══════════════════════════════════════════════════════════════════╝  │
│                                    │                                    │
│  ╔═══════════════════════════════════════════════════════════════════╗  │
│  ║  Layer 3: 실행 격리 (Execution Isolation)                          ║  │
│  ║  ┌──────────────┬──────────────┬──────────────┬──────────────┐   ║  │
│  ║  │ Docker       │ 네임스페이스 │ 리소스 제한  │ seccomp     │   ║  │
│  ║  │ 컨테이너     │ 분리        │ (cgroups)   │ (syscall)   │   ║  │
│  ║  └──────────────┴──────────────┴──────────────┴──────────────┘   ║  │
│  ╚═══════════════════════════════════════════════════════════════════╝  │
│                                    │                                    │
│  ╔═══════════════════════════════════════════════════════════════════╗  │
│  ║  Layer 2: 데이터 유출 방지 (DLP)                                   ║  │
│  ║  ┌──────────────┬──────────────┬──────────────┬──────────────┐   ║  │
│  ║  │ 클립보드     │ 파일 반출    │ 화면 캡처   │ 인쇄 통제   │   ║  │
│  ║  │ 차단        │ 차단        │ 제한        │ 워터마크    │   ║  │
│  ║  └──────────────┴──────────────┴──────────────┴──────────────┘   ║  │
│  ╚═══════════════════════════════════════════════════════════════════╝  │
│                                    │                                    │
│  ╔═══════════════════════════════════════════════════════════════════╗  │
│  ║  Layer 1: 감사 및 모니터링 (Audit & Monitoring)                    ║  │
│  ║  ┌──────────────┬──────────────┬──────────────┬──────────────┐   ║  │
│  ║  │ 세션 로깅    │ LLM I/O 기록 │ 이상 탐지   │ SIEM 연동   │   ║  │
│  ║  │ (전행위기록) │ (프롬프트)   │ (AI 기반)   │ (통합관제)  │   ║  │
│  ║  └──────────────┴──────────────┴──────────────┴──────────────┘   ║  │
│  ╚═══════════════════════════════════════════════════════════════════╝  │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 2. Layer 5: 접근 제어 (Access Control)

### 2.1 인증 흐름

```
┌─────────────────────────────────────────────────────────────────────────┐
│                           인증 흐름도                                    │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   사용자                    인증 시스템                    VDI           │
│     │                          │                          │            │
│     │  1. 접속 요청            │                          │            │
│     │─────────────────────────▶│                          │            │
│     │                          │                          │            │
│     │  2. DID 인증 요청        │                          │            │
│     │◀─────────────────────────│                          │            │
│     │                          │                          │            │
│     │  3. 모바일 신분증 제시   │                          │            │
│     │─────────────────────────▶│                          │            │
│     │     (생체인증 포함)       │                          │            │
│     │                          │                          │            │
│     │  4. 2FA (OTP) 요청       │                          │            │
│     │◀─────────────────────────│                          │            │
│     │                          │                          │            │
│     │  5. OTP 입력             │                          │            │
│     │─────────────────────────▶│                          │            │
│     │                          │                          │            │
│     │                          │  6. 권한 조회 (RBAC)     │            │
│     │                          │─────────────────────────▶│            │
│     │                          │                          │            │
│     │  7. 세션 생성 완료       │                          │            │
│     │◀─────────────────────────┼──────────────────────────│            │
│     │                          │                          │            │
└─────────────────────────────────────────────────────────────────────────┘
```

### 2.2 역할 기반 접근 제어 (RBAC)

| 역할 | 권한 | 접근 가능 데이터 |
|------|------|-----------------|
| **의원** | 전체 | 본인 관련 의정자료, 공개 자료 |
| **보좌진** | 제한 | 소속 의원 자료, 공개 자료 |
| **사무처** | 관리 | 전체 자료 (관리 목적) |
| **외부인** | 없음 | 접근 불가 |

### 2.3 세션 관리 정책

| 정책 | 설정값 | 비고 |
|------|-------|------|
| 세션 타임아웃 | 30분 | 유휴 시 자동 종료 |
| 최대 세션 수 | 1개/사용자 | 동시 접속 방지 |
| 세션 갱신 | 활동 시 연장 | 최대 8시간 |
| 강제 종료 | 관리자 가능 | 긴급 시 |

---

## 3. Layer 4: 네트워크 분리 (Network Isolation)

### 3.1 네트워크 구조

```
┌─────────────────────────────────────────────────────────────────────────┐
│                        네트워크 보안 구조                                │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                     인터넷망 (외부)                               │   │
│  │   ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐       │   │
│  │   │ 본회의장  │  │ 상임위   │  │ 지역상담소│  │ 노트북   │       │   │
│  │   └────┬─────┘  └────┬─────┘  └────┬─────┘  └────┬─────┘       │   │
│  │        └──────────────┴──────────────┴──────────────┘           │   │
│  │                              │                                   │   │
│  │                       ┌──────▼──────┐                           │   │
│  │                       │   VPN GW    │ ← TLS 1.3 암호화          │   │
│  │                       └──────┬──────┘                           │   │
│  └──────────────────────────────┼───────────────────────────────────┘   │
│                                 │                                       │
│  ═══════════════════════════════╪═══════════════════════════════════    │
│                          망분리 경계                                     │
│  ═══════════════════════════════╪═══════════════════════════════════    │
│                                 │                                       │
│  ┌──────────────────────────────┼───────────────────────────────────┐   │
│  │                        DMZ 영역                                   │   │
│  │                       ┌──────▼──────┐                            │   │
│  │   ┌──────────────┐   │   방화벽    │   ┌──────────────┐         │   │
│  │   │ VDI Gateway  │◀──┤ (Whitelist) ├──▶│ 로드밸런서   │         │   │
│  │   └──────┬───────┘   └─────────────┘   └──────┬───────┘         │   │
│  │          │                                     │                 │   │
│  │          └──────────────┬──────────────────────┘                 │   │
│  │                         │                                        │   │
│  │                  ┌──────▼──────┐                                 │   │
│  │                  │ VDI 서버팜   │                                 │   │
│  │                  │ (Docker)    │                                 │   │
│  │                  └──────┬──────┘                                 │   │
│  └─────────────────────────┼────────────────────────────────────────┘   │
│                            │                                            │
│  ══════════════════════════╪════════════════════════════════════════    │
│                       내부 방화벽                                        │
│  ══════════════════════════╪════════════════════════════════════════    │
│                            │                                            │
│  ┌─────────────────────────┼────────────────────────────────────────┐   │
│  │                    내부망 (핵망)                                   │   │
│  │                  ┌──────▼──────┐                                 │   │
│  │                  │ API Gateway │ ← LLM API만 허용                │   │
│  │                  └──────┬──────┘                                 │   │
│  │                         │                                        │   │
│  │   ┌──────────────┬──────┴───────┬──────────────┐                │   │
│  │   │              │              │              │                │   │
│  │   ▼              ▼              ▼              ▼                │   │
│  │ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐                │   │
│  │ │LLM 서버 │ │RAG 시스템│ │ 벡터DB  │ │ 문서DB  │                │   │
│  │ └─────────┘ └─────────┘ └─────────┘ └─────────┘                │   │
│  └──────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 3.2 방화벽 정책 (화이트리스트)

| 출발지 | 목적지 | 포트 | 프로토콜 | 허용 |
|--------|--------|------|---------|------|
| 인터넷 | VPN GW | 443 | HTTPS | O |
| VPN GW | VDI GW | 8443 | ICA/RDP | O |
| VDI 서버 | API GW | 8080 | HTTPS | O |
| API GW | LLM 서버 | 11434 | HTTP | O |
| API GW | RAG 서버 | 8000 | HTTP | O |
| * | * | * | * | **X** |

### 3.3 VDI 프로토콜 보안

| 항목 | 설정 | 비고 |
|------|------|------|
| 프로토콜 | ICA/HDX (Citrix) | 화면 스트리밍만 |
| 암호화 | TLS 1.3 | 종단간 암호화 |
| 압축 | 적응형 | 대역폭 최적화 |
| 데이터 전송 | 비활성화 | 파일/클립보드 차단 |

---

## 4. Layer 3: 실행 격리 (Execution Isolation)

### 4.1 Docker 컨테이너 보안

```yaml
# OpenClaw 컨테이너 보안 설정 예시
version: '3.8'
services:
  openclaw:
    image: openclaw:latest
    security_opt:
      - no-new-privileges:true
      - seccomp:seccomp-profile.json
    cap_drop:
      - ALL
    cap_add:
      - NET_BIND_SERVICE
    read_only: true
    tmpfs:
      - /tmp:noexec,nosuid,nodev
    networks:
      - isolated_network
    deploy:
      resources:
        limits:
          cpus: '2'
          memory: 4G
        reservations:
          cpus: '1'
          memory: 2G
```

### 4.2 격리 정책

| 정책 | 설정 | 효과 |
|------|------|------|
| 네임스페이스 | 사용자별 분리 | 세션 간 격리 |
| cgroups | CPU 2코어, 메모리 4GB | 리소스 제한 |
| seccomp | 허용 syscall만 | 커널 공격 방지 |
| AppArmor | 프로파일 적용 | 파일 접근 제한 |
| 읽기 전용 | 루트 파일시스템 | 변조 방지 |

---

## 5. Layer 2: 데이터 유출 방지 (DLP)

### 5.1 DLP 정책 매트릭스

| 채널 | 정책 | 설정 | 예외 |
|------|------|------|------|
| **클립보드** | 차단 | 양방향 차단 | 없음 |
| **파일 반출** | 차단 | 업로드/다운로드 차단 | 관리자 승인 |
| **파일 반입** | 제한 | 스캔 후 허용 | 문서 파일만 |
| **화면 캡처** | 제한 | VDI 내 차단 | 로그 기록 |
| **인쇄** | 제한 | 워터마크 필수 | 승인 프로세스 |
| **USB** | 차단 | 완전 비활성화 | 없음 |

### 5.2 워터마크 정책

```
┌─────────────────────────────────────────────────────────────────┐
│                      화면 워터마크 예시                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│    ┌───────────────────────────────────────────────────────┐   │
│    │                                                       │   │
│    │     경기도의회 VDI                                     │   │
│    │                                                       │   │
│    │         홍길동 의원 (hong@assembly.go.kr)              │   │
│    │              2026-02-04 14:30:22                      │   │
│    │                  192.168.1.100                        │   │
│    │                                                       │   │
│    │     ─────────────────────────────────────────        │   │
│    │                                                       │   │
│    │              [업무 화면 내용]                          │   │
│    │                                                       │   │
│    │                                                       │   │
│    └───────────────────────────────────────────────────────┘   │
│                                                                 │
│    워터마크 정보:                                               │
│    • 사용자 이름/이메일 (투명 오버레이)                         │
│    • 접속 시간 (타임스탬프)                                    │
│    • 접속 IP 주소                                              │
│    • 세션 ID (추적용)                                          │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 6. Layer 1: 감사 및 모니터링 (Audit & Monitoring)

### 6.1 로깅 범위

| 로그 유형 | 수집 항목 | 보관 기간 | 용도 |
|----------|----------|----------|------|
| **인증 로그** | 로그인/로그아웃, 실패 시도 | 1년 | 접근 감사 |
| **세션 로그** | 접속 시간, IP, 행위 | 6개월 | 행위 추적 |
| **LLM 로그** | 프롬프트, 응답, 토큰 | 1년 | AI 감사 |
| **파일 로그** | 접근/수정/삭제 | 1년 | 데이터 감사 |
| **시스템 로그** | 오류, 성능, 보안 이벤트 | 3개월 | 운영 |

### 6.2 LLM 입출력 감사

```
┌─────────────────────────────────────────────────────────────────┐
│                      LLM 감사 로그 예시                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  {                                                              │
│    "timestamp": "2026-02-04T14:30:22.123Z",                    │
│    "session_id": "sess_abc123",                                │
│    "user": {                                                   │
│      "id": "user_001",                                         │
│      "name": "홍길동",                                          │
│      "role": "의원",                                            │
│      "ip": "192.168.1.100"                                     │
│    },                                                          │
│    "request": {                                                │
│      "prompt": "환경 관련 조례안 현황 알려줘",                    │
│      "tokens": 15,                                             │
│      "context_docs": ["doc_001", "doc_002"]                    │
│    },                                                          │
│    "response": {                                               │
│      "text": "최근 3개월간 환경 관련 조례안은...",               │
│      "tokens": 150,                                            │
│      "sources": ["회의록_2026-01-15", "조례안_123"]             │
│    },                                                          │
│    "latency_ms": 2340,                                         │
│    "status": "success"                                         │
│  }                                                             │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### 6.3 이상 탐지 규칙

| 규칙 | 조건 | 알림 수준 | 대응 |
|------|------|----------|------|
| 다중 실패 | 5회 연속 로그인 실패 | 경고 | 계정 잠금 |
| 비정상 시간 | 22시~06시 접속 | 정보 | 로그 기록 |
| 대량 쿼리 | 1시간 100회 초과 | 경고 | 레이트 리밋 |
| 민감 키워드 | 특정 키워드 포함 | 경고 | 관리자 알림 |

---

## 7. 보안 체크리스트

### PoC 단계 필수
- [ ] DID + 2FA 인증 구현
- [ ] 클립보드/파일반출 차단 설정
- [ ] Docker 컨테이너 격리 설정
- [ ] 기본 로깅 활성화
- [ ] 방화벽 화이트리스트 설정

### 본사업 단계 필수
- [ ] RBAC 권한 체계 구현
- [ ] 화면 워터마크 적용
- [ ] SIEM 연동
- [ ] 침투테스트 실시
- [ ] 보안 감사 통과

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 |
|------|------|----------|
| 1.0 | 2026-02-04 | 초안 작성 |
